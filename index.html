<html>
<head>
  <title>Calendario Laboral 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="script.js" defer></script>
  <script>
    // Función para guardar datos en localStorage
    function guardarDatos() {
        const resumenMes = {
            mañanas: parseInt(document.getElementById('mañanas').value) || 0,
            tardes: parseInt(document.getElementById('tardes').value) || 0,
            noches: parseInt(document.getElementById('noches').value) || 0,
            adelantos: parseInt(document.getElementById('adelantos').value) || 0,
            vacaciones: parseInt(document.getElementById('vacaciones').value) || 0,
            flexibilidad: parseInt(document.getElementById('flexibilidad').value) || 0,
            total: document.getElementById('total').innerText
        };

        const resumenAnual = {
            mañanas: parseInt(document.getElementById('mañanas-anual').value) || 0,
            tardes: parseInt(document.getElementById('tardes-anual').value) || 0,
            noches: parseInt(document.getElementById('noches-anual').value) || 0,
            adelantos: parseInt(document.getElementById('adelantos-anual').value) || 0,
            vacaciones: parseInt(document.getElementById('vacaciones-anual').value) || 0,
            flexibilidad: parseInt(document.getElementById('flexibilidad-anual').value) || 0,
            totalDiasTrabajados: parseInt(document.getElementById('total-dias-trabajados').value) || 0,
            totalDiasVacacionesUsados: parseInt(document.getElementById('total-dias-vacaciones-usados').value) || 0,
            totalDiasTrabajadosFinSemana: parseInt(document.getElementById('total-dias-trabajados-fin-semana').value) || 0,
            totalDiasBaja: parseInt(document.getElementById('total-dias-baja').value) || 0
        };

        // Guardar en localStorage
        localStorage.setItem('resumenMes', JSON.stringify(resumenMes));
        localStorage.setItem('resumenAnual', JSON.stringify(resumenAnual));

        alert('Datos guardados correctamente.');
    }

    // Función para cargar datos desde localStorage
    function cargarDatos() {
        const resumenMesGuardado = JSON.parse(localStorage.getItem('resumenMes'));
        const resumenAnualGuardado = JSON.parse(localStorage.getItem('resumenAnual'));

        if (resumenMesGuardado) {
            document.getElementById('mañanas').value = resumenMesGuardado.mañanas;
            document.getElementById('tardes').value = resumenMesGuardado.tardes;
            document.getElementById('noches').value = resumenMesGuardado.noches;
            document.getElementById('adelantos').value = resumenMesGuardado.adelantos;
            document.getElementById('vacaciones').value = resumenMesGuardado.vacaciones;
            document.getElementById('flexibilidad').value = resumenMesGuardado.flexibilidad;
            document.getElementById('total').innerText = resumenMesGuardado.total;
        }

        if (resumenAnualGuardado) {
            document.getElementById('mañanas-anual').value = resumenAnualGuardado.mañanas;
            document.getElementById('tardes-anual').value = resumenAnualGuardado.tardes;
            document.getElementById('noches-anual').value = resumenAnualGuardado.noches;
            document.getElementById('adelantos-anual').value = resumenAnualGuardado.adelantos;
            document.getElementById('vacaciones-anual').value = resumenAnualGuardado.vacaciones;
            document.getElementById('flexibilidad-anual').value = resumenAnualGuardado.flexibilidad;
            document.getElementById('total-dias-trabajados').value = resumenAnualGuardado.totalDiasTrabajados;
            document.getElementById('total-dias-vacaciones-usados').value = resumenAnualGuardado.totalDiasVacacionesUsados;
            document.getElementById('total-dias-trabajados-fin-semana').value = resumenAnualGuardado.totalDiasTrabajadosFinSemana;
            document.getElementById('total-dias-baja').value = resumenAnualGuardado.totalDiasBaja;
        }
    }

    // Cargar datos al cargar la página
    window.onload = cargarDatos;
</script>
  <meta charset="UTF-8">
  <style>
    :root {
      --turno-m: #FFB6C1;
      --turno-t: #98FB98;  
      --turno-n: #87CEEB;
      --turno-a: #DDA0DD;
      --turno-v: #F0E68C;
      --festivo: #FF6B6B;
      --especial: #DDA0DD;
      --nuevo-especial: #2ecc71;
      --october-17: #DAA520;
      --turno-fl: #FFA07A;
      --festivo-convenio: #D3D3D3;
      --turno-b: #4682B4; 
      --turno-pnr: #FF1493; 
      --turno-lpf: #40E0D0; 
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ff6961;
    }

    body::before {
      content: "CC.OO";
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 15vw;
      color: rgba(0, 0, 0, 0.1);
      white-space: nowrap;
      pointer-events: none;
      z-index: -1;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
      margin-bottom: 20px;
      border: 2px solid red;
      padding: 5px;
      background-color: white;
      max-width: 700px;
      margin: 0 auto;
    }

    .day {
      border: 1px solid black;
      padding: 2px;
      min-height: 25px;
      position: relative;
      background-color: white;
      font-size: 0.75rem;
    }

    .day:nth-child(7n),  /* Sunday */
    .day:nth-child(7n-1) /* Saturday */ {
      background-color: #8f8f8f;
    }

    .day.festivo {
      background-color: var(--festivo);
    }

    .day.especial {
      background-color: var(--festivo-convenio);
    }

    .day.nuevo-especial {
      background-color: var(--nuevo-especial);
    }

    .day.october-17 {
      background-color: var(--october-17);
    }

    .day-header {
      font-weight: bold;
      margin-bottom: 1px;
      font-size: 0.8rem;
      padding: 1px;
    }

    .controls {
      margin-bottom: 5px;
      padding: 4px;
      background-color: white;
      border-radius: 4px;
      border: 2px solid red;
      max-width: 700px;
      margin: 0 auto;
    }

    .month-nav {
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .month-nav button {
      padding: 3px 5px;
      font-size: 0.8rem;
      border-radius: 4px;
      border: 1px solid red;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      color: red;
    }

    .month-nav button:hover {
      background: #ffe6e6;
      color: darkred;
    }

    .legend {
      display: flex;
      gap: 2px;
      margin-bottom: 4px;
      font-size: 0.7rem;
      padding: 3px;
      max-width: 700px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 2px;
      padding: 1px;
      font-size: 0.65rem;
    }

    .legend-color {
      width: 6px;
      height: 6px;
      border-radius: 2px;
      border: 1px solid black;
    }

    .turno-select {
      width: 100%;
      padding: 2px;
      margin-top: 1px;
      background-color: white;
      border: 1px solid black;
      border-radius: 2px;
      font-size: 0.7rem;
    }

    .turno-select option[value=""] { background-color: white; }
    .turno-select option[value="M"] { background-color: var(--turno-m); }
    .turno-select option[value="T"] { background-color: var(--turno-t); }
    .turno-select option[value="N"] { background-color: var(--turno-n); }
    .turno-select option[value="A"] { background-color: var(--turno-a); }
    .turno-select option[value="V"] { background-color: var(--turno-v); }
    .turno-select option[value="F"] { background-color: var(--festivo); }
    .turno-select option[value="FL"] { background-color: var(--turno-fl); }
    .turno-select option[value="B"] { background-color: var(--turno-b); color: white; }
    .turno-select option[value="PNR"] { background-color: var(--turno-pnr); color: white; }
    .turno-select option[value="LPF"] { background-color: var(--turno-lpf); }

    .day-content {
      padding: 1px;
      border-radius: 2px;
      margin-top: 1px;
    }

    .turno-m { background-color: var(--turno-m); }
    .turno-t { background-color: var(--turno-t); }
    .turno-n { background-color: var(--turno-n); }
    .turno-a { background-color: var(--turno-a); }
    .turno-v { background-color: var(--turno-v); }
    .turno-f { background-color: var(--festivo); }
    .turno-fl { background-color: var(--turno-fl); }
    .turno-b { background-color: var(--turno-b); color: white; }
    .turno-pnr { background-color: var(--turno-pnr); color: white; }
    .turno-lpf { background-color: var(--turno-lpf); }

    .summary {
      background-color: white;
      padding: 6px;
      margin-top: 5px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border: 2px solid red;
      max-width: 700px;
      margin: 0 auto;
    }

    .summary h3 {
      margin-top: 0;
      margin-bottom: 3px;
      font-size: 1rem;
      font-weight: 600;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 2px;
    }

    .summary-item {
      padding: 2px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .vacation-count {
      background-color: #F0E68C !important;  /* Light khaki yellow */
    }

    .annual-summary {
      background-color: white;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: none;
      border: 2px solid red;
      max-width: 700px;
      margin: 0 auto;
    }

    .annual-summary.visible {
      display: block;
    }
    
    .work-days-info {
      margin-top: 3px;
      padding: 4px;
      background-color: #f5f5f5;
      border-radius: 5px;
      font-size: 0.8rem;
      border: 1px solid black;
    }

    h2 {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0.5rem 0;
    }

    .save-button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .save-button:hover {
      background-color: #45a049;
    }

    .save-status {
      color: #4CAF50;
      font-size: 0.8rem;
      margin-left: 10px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .save-status.visible {
      opacity: 1;
    }

    .controls-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 5px;
    }
   
  </style>

  <div class="controls">
    <div class="month-nav">
      <button onclick="prevMonth()">Anterior</button>
      <h2 id="currentMonth">Enero 2025</h2>
      <button onclick="nextMonth()">Siguiente</button>
    </div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background-color: white; border: 1px solid #ccc"></div>
        <span>Descanso</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-m)"></div>
        <span>Mañana</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-t)"></div>
        <span>Tarde</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-n)"></div>
        <span>Noche</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-a)"></div>
        <span>Adelanto</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-v)"></div>
        <span>Vacaciones</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--festivo)"></div>
        <span>Festivo</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-fl)"></div>
        <span>Flexibilidad</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--october-17)"></div>
        <span>Patrona</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--festivo-convenio)"></div>
        <span>Festivo Convenio</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #2ecc71"></div>
        <span>Festivos Locales</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-b)"></div>
        <span>Baja</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-pnr)"></div>
        <span>Permiso no retribuido</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--turno-lpf)"></div>
        <span>Libres por festivo</span>
      </div>
    </div>
    <div class="controls-buttons">
      <button class="save-button" onclick="saveCalendarData()">Guardar</button>
      <span id="saveStatus" class="save-status">✓ Guardado correctamente</span>
    </div>
  </div>

  <div id="calendar" class="calendar"></div>
  <div id="summary" class="summary">
    <h3>Resumen del mes</h3>
    <div class="summary-grid">
      <div class="summary-item turno-m" id="count-m">Mañanas: 0</div>
      <div class="summary-item turno-t" id="count-t">Tardes: 0</div>
      <div class="summary-item turno-n" id="count-n">Noches: 0</div>
      <div class="summary-item turno-a" id="count-a">Adelantos: 0</div>
      <div class="summary-item turno-v" id="count-v">Vacaciones: 0</div>
      <div class="summary-item turno-fl" id="count-fl">Flexibilidad: 0</div>
      <div class="summary-item" id="count-total">Total: 0</div>
      <div class="summary-item vacation-count" id="vacation-days">Días de vacaciones restantes: 22</div>
      <div class="summary-item" id="weekend-days" style="background-color: #8f8f8f">Días trabajados en fin de semana: 0</div>
      <div class="summary-item turno-b" id="count-b">Días de baja: 0</div>
    </div>
    <div id="workDaysInfo" class="work-days-info"></div>
  </div>

  <div id="annual-summary" class="annual-summary">
    <h3>Resumen Anual 2025</h3>
    <div class="summary-grid">
      <div class="summary-item turno-m" id="annual-m">Mañanas: 0</div>
      <div class="summary-item turno-t" id="annual-t">Tardes: 0</div>
      <div class="summary-item turno-n" id="annual-n">Noches: 0</div>
      <div class="summary-item turno-a" id="annual-a">Adelantos: 0</div>
      <div class="summary-item turno-v" id="annual-v">Vacaciones: 0</div>
      <div class="summary-item turno-fl" id="annual-fl">Flexibilidad: 0</div>
      <div class="summary-item" id="annual-total">Total días trabajados: 0</div>
      <div class="summary-item vacation-count" id="annual-vacation-days">Total días vacaciones usados: 0</div>
      <div class="summary-item" id="annual-weekend-days" style="background-color: #8f8f8f">Total días trabajados en fin de semana: 0</div>
      <div class="summary-item turno-b" id="annual-b">Total días de baja: 0</div>
    </div>
  </div>

  <script>
    const festivos2025 = ['2025-01-01', '2025-01-06', '2025-03-19', '2025-04-18', '2025-04-21', '2025-05-01', '2025-08-15', '2025-10-09', '2025-10-12', '2025-11-01', '2025-12-06', '2025-12-25'];
    const diasEspeciales = ['2025-03-18', '2025-12-24', '2025-12-31'];
    const diasNuevoEspeciales = ['2025-08-14', '2025-09-08'];
    const diasOctubre17 = ['2025-10-17'];
    let currentDate = new Date(2025, 0, 1);
    const turnosText = {
      '': 'Descanso',
      'M': 'Mañana',
      'T': 'Tarde',
      'N': 'Noche',
      'A': 'Adelanto',
      'V': 'Vacaciones',
      'F': 'Festivo',
      'FL': 'Flexibilidad',
      'B': 'Baja',
      'PNR': 'Permiso no retribuido',
      'LPF': 'Libres por festivo'
    };
    const diasSemana = ['Lun.', 'Mar.', 'Mie.', 'Jue.', 'Vie.', 'Sab.', 'Dom.'];
    const monthlyWorkDays = {
      0: {
        days: 21,
        hours: 168
      },
      1: {
        days: 20,
        hours: 160
      },
      2: {
        days: 19,
        hours: 152
      },
      3: {
        days: 20,
        hours: 160
      },
      4: {
        days: 21,
        hours: 168
      },
      5: {
        days: 21,
        hours: 168
      },
      6: {
        days: 23,
        hours: 184
      },
      7: {
        days: 19,
        hours: 152
      },
      8: {
        days: 21,
        hours: 168
      },
      9: {
        days: 21,
        hours: 168
      },
      10: {
        days: 20,
        hours: 160
      },
      11: {
        days: 19,
        hours: 152
      }
    };
    function asignarTurno(select, fecha) {
  const turno = select.value;
  // ... 
  localStorage.setItem(fecha, turno); // Guarda el turno de la fecha
  updateSummary();
}
    function saveCalendarData() {
  const calendarData = {};
  
  // Recopila todos los días del año
  for (let month = 0; month < 12; month++) {
    for (let day = 1; day <= 31; day++) {
      const date = new Date(2025, month, day);
      if (date.getMonth() === month) {
        const fecha = `2025-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const turno = localStorage.getItem(fecha);
        if (turno) calendarData[fecha] = turno;
      }
    }
  }
      function loadCalendarData() {
  const savedData = localStorage.getItem('calendarData2025');
  if (savedData) {
    const calendarData = JSON.parse(savedData);
    // Restaura cada fecha
    Object.entries(calendarData).forEach(([fecha, turno]) => {
      localStorage.setItem(fecha, turno);
    });
  }
}

// Al cargar la página
loadCalendarData();
renderCalendar();

  localStorage.setItem('calendarData2025', JSON.stringify(calendarData)); // Guarda como JSON
  // Muestra confirmación
  document.getElementById('saveStatus').classList.add('visible');
  setTimeout(() => {
    document.getElementById('saveStatus').classList.remove('visible');
  }, 2000);
}

    function updateSummary() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const counts = {
        'M': 0,
        'T': 0,
        'N': 0,
        'A': 0,
        'V': 0,
        'FL': 0,
        'B': 0,
        'PNR': 0,
        'LPF': 0
      };
      
      let weekendDays = 0;
      
      for (let day = 1; day <= 31; day++) {
        const date = new Date(year, month, day);
        if (date.getMonth() === month) {
          const fecha = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const turno = localStorage.getItem(fecha);
          
          const isWeekend = [0, 6].includes(date.getDay());
          if (isWeekend && turno && turno !== '' && turno !== 'V' && turno !== 'B' && turno !== 'LPF') {
            weekendDays++;
          }
          
          if (turno && counts.hasOwnProperty(turno)) {
            counts[turno]++;
          }
        }
      }
      
      document.getElementById('count-m').textContent = `Mañanas: ${counts['M']}`;
      document.getElementById('count-t').textContent = `Tardes: ${counts['T']}`;
      document.getElementById('count-n').textContent = `Noches: ${counts['N']}`;
      document.getElementById('count-a').textContent = `Adelantos: ${counts['A']}`;
      document.getElementById('count-v').textContent = `Vacaciones: ${counts['V']}`;
      document.getElementById('count-fl').textContent = `Flexibilidad: ${counts['FL']}`;
      document.getElementById('count-b').textContent = `Días de baja: ${counts['B']}`;
      document.getElementById('weekend-days').textContent = `Días trabajados en fin de semana: ${weekendDays}`;
      
      const total = Object.entries(counts).reduce((sum, [key, count]) => {
        return (key !== 'B' && key !== 'LPF') ? sum + count : sum;
      }, 0);
      
      document.getElementById('count-total').textContent = `Total: ${total}`;
      
      let totalVacationDaysUsed = 0;
      for (let m = 0; m <= month; m++) {
        for (let day = 1; day <= 31; day++) {
          const fecha = `${year}-${String(m + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const turno = localStorage.getItem(fecha);
          if (turno === 'V') {
            totalVacationDaysUsed++;
          }
        }
      }
      const remainingVacationDays = 22 - totalVacationDaysUsed;
      document.getElementById('vacation-days').textContent = `Días de vacaciones restantes: ${remainingVacationDays}`;

      const annualSummary = document.getElementById('annual-summary');
      annualSummary.classList.toggle('visible', month === 11);
      if (month === 11) {
        calculateAnnualSummary();
      }
    }

    function calculateAnnualSummary() {
      const counts = {
        'M': 0,
        'T': 0,
        'N': 0,
        'A': 0,
        'V': 0,
        'FL': 0,
        'B': 0,
        'PNR': 0,
        'LPF': 0
      };
      
      let totalWeekendDays = 0;
      
      for (let month = 0; month < 12; month++) {
        for (let day = 1; day <= 31; day++) {
          const date = new Date(2025, month, day);
          if (date.getMonth() === month) {
            const fecha = `2025-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const turno = localStorage.getItem(fecha);
            
            const isWeekend = [0, 6].includes(date.getDay());
            if (isWeekend && turno && turno !== '' && turno !== 'V' && turno !== 'B' && turno !== 'LPF') {
              totalWeekendDays++;
            }
            
            if (turno && counts.hasOwnProperty(turno)) {
              counts[turno]++;
            }
          }
        }
      }
      
      document.getElementById('annual-m').textContent = `Mañanas: ${counts['M']}`;
      document.getElementById('annual-t').textContent = `Tardes: ${counts['T']}`;
      document.getElementById('annual-n').textContent = `Noches: ${counts['N']}`;
      document.getElementById('annual-a').textContent = `Adelantos: ${counts['A']}`;
      document.getElementById('annual-v').textContent = `Vacaciones: ${counts['V']}`;
      document.getElementById('annual-fl').textContent = `Flexibilidad: ${counts['FL']}`;
      document.getElementById('annual-b').textContent = `Total días de baja: ${counts['B']}`;
      document.getElementById('annual-weekend-days').textContent = `Total días trabajados en fin de semana: ${totalWeekendDays}`;
      
      const total = Object.entries(counts).reduce((sum, [key, count]) => {
        return (key !== 'B' && key !== 'LPF') ? sum + count : sum;
      }, 0);
      
      document.getElementById('annual-total').textContent = `Total días trabajados: ${total}`;
      document.getElementById('annual-vacation-days').textContent = `Total días vacaciones usados: ${counts['V']}`;
    }

    function getTurnoColor(turno) {
      const colors = {
        '': 'white',
        'M': 'var(--turno-m)',
        'T': 'var(--turno-t)',
        'N': 'var(--turno-n)',
        'A': 'var(--turno-a)',
        'V': 'var(--turno-v)',
        'F': 'var(--festivo)',
        'FL': 'var(--turno-fl)',
        'B': 'var(--turno-b)',
        'PNR': 'var(--turno-pnr)',
        'LPF': 'var(--turno-lpf)'
      };
      return colors[turno] || 'white';
    }

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const monthName = new Intl.DateTimeFormat('es-ES', {
        month: 'long',
        year: 'numeric'
      }).format(currentDate);
      document.getElementById('currentMonth').textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';
      diasSemana.forEach(dia => {
        const header = document.createElement('div');
        header.className = 'day-header';
        header.textContent = dia;
        calendar.appendChild(header);
      });
      const mondayBasedDay = (firstDay.getDay() + 6) % 7;
      for (let i = 0; i < mondayBasedDay; i++) {
        calendar.appendChild(document.createElement('div'));
      }
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        const mondayBasedDayOfWeek = (date.getDay() + 6) % 7;
        if (mondayBasedDayOfWeek === 5 || mondayBasedDayOfWeek === 6) {
          dayEl.classList.add('weekend');
        } else {
          dayEl.classList.add('weekday');
        }
        const fecha = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        if (festivos2025.includes(fecha)) {
          dayEl.classList.add('festivo');
        }
        if (diasEspeciales.includes(fecha)) {
          dayEl.classList.add('especial');
          const festivoText = document.createElement('div');
          festivoText.style.fontSize = '0.6rem';
          festivoText.style.fontWeight = 'bold';
          festivoText.textContent = 'Festivo Convenio';
          dayEl.appendChild(festivoText);
        }
        if (diasNuevoEspeciales.includes(fecha)) {
          dayEl.classList.add('nuevo-especial');
        }
        if (diasOctubre17.includes(fecha)) {
          dayEl.classList.add('october-17');
        }
        const savedTurno = localStorage.getItem(fecha) || '';
        if (diasOctubre17.includes(fecha) && month === 9) {
          const patronaText = document.createElement('div');
          patronaText.style.fontSize = '0.6rem';
          patronaText.style.fontWeight = 'bold';
          patronaText.textContent = 'Patrona';
          dayEl.appendChild(patronaText);
        }
        dayEl.innerHTML = `
          <div class="day-header">${day}</div>
          <div class="day-content ${savedTurno ? 'turno-' + savedTurno.toLowerCase() : ''}">
            <select class="turno-select" onchange="asignarTurno(this, '${fecha}')" style="background-color: ${getTurnoColor(savedTurno)}">
              <option value="" ${savedTurno === '' ? 'selected' : ''}>Descanso</option>
              <option value="M" ${savedTurno === 'M' ? 'selected' : ''}>Mañana</option>
              <option value="T" ${savedTurno === 'T' ? 'selected' : ''}>Tarde</option>
              <option value="N" ${savedTurno === 'N' ? 'selected' : ''}>Noche</option>
              <option value="A" ${savedTurno === 'A' ? 'selected' : ''}>Adelanto</option>
              <option value="V" ${savedTurno === 'V' ? 'selected' : ''}>Vacaciones</option>
              <option value="F" ${savedTurno === 'F' ? 'selected' : ''}>Festivo</option>
              <option value="FL" ${savedTurno === 'FL' ? 'selected' : ''}>Flexibilidad</option>
              <option value="B" ${savedTurno === 'B' ? 'selected' : ''}>Baja</option>
              <option value="PNR" ${savedTurno === 'PNR' ? 'selected' : ''}>Permiso no retribuido</option>
              <option value="LPF" ${savedTurno === 'LPF' ? 'selected' : ''}>Libres por festivo</option>
            </select>
          </div>
        `;
        calendar.appendChild(dayEl);
      }
      const workInfo = monthlyWorkDays[month];
      const workDaysInfo = document.getElementById('workDaysInfo');
      if (workInfo) {
        workDaysInfo.textContent = `Días laborables: ${workInfo.days} días ${workInfo.hours} Horas`;
      } else {
        workDaysInfo.textContent = '';
      }
      updateSummary();
    }

    function asignarTurno(select, fecha) {
      const turno = select.value;
      const dayContent = select.parentElement;
      dayContent.className = 'day-content';
      if (turno) {
        dayContent.classList.add(`turno-${turno.toLowerCase()}`);
      }
      select.style.backgroundColor = getTurnoColor(turno);
      localStorage.setItem(fecha, turno);
      updateSummary();
    }

    function prevMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    function saveCalendarData() {
      const calendarData = {};
      
      // Collect all data from localStorage related to calendar
      for (let month = 0; month < 12; month++) {
        for (let day = 1; day <= 31; day++) {
          const date = new Date(2025, month, day);
          if (date.getMonth() === month) { // Valid date check
            const fecha = `2025-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const turno = localStorage.getItem(fecha);
            if (turno) {
              calendarData[fecha] = turno;
            }
          }
        }
      }

      // Save to localStorage as JSON
      localStorage.setItem('calendarData2025', JSON.stringify(calendarData));
      
      // Show save confirmation
      const saveStatus = document.getElementById('saveStatus');
      saveStatus.classList.add('visible');
      setTimeout(() => {
        saveStatus.classList.remove('visible');
      }, 2000);
    }

    function loadCalendarData() {
      const savedData = localStorage.getItem('calendarData2025');
      if (savedData) {
        const calendarData = JSON.parse(savedData);
        // Restore saved data to localStorage
        Object.entries(calendarData).forEach(([fecha, turno]) => {
          localStorage.setItem(fecha, turno);
        });
      }
    }

    // Load saved data when page loads
    loadCalendarData();
    renderCalendar();
  </script>

</head>
<body>
  
</body>
</html>
